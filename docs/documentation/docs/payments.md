---
id: payments
title: Payments
---

The Checkout.com Payments API provides a unified integration experience for a variety of payment methods. 

You can find a list of request body parameters and possible outcomes [here](https://api-reference.checkout.com/#tag/Payments).

export const Highlight = ({children, color}) => (
<span
style={{
      color: color,
      padding: '0.2rem',
    }}>
{children}
</span>
);

To request a payment you must create an instance of `PaymentRequest<TSource>` where `TSource` is the source of payment, for example:

```jsx
var paymentRequest = new PaymentRequest<TokenSource>(new TokenSource("tok_ubfj2q76miwundwlk72vxt2i7q"), Currency.USD, 1000);
var paymentResponse = await api.Payments.RequestAsync(paymentRequest);
```

## Request a card payment
There are a number of ways to request a card payment, as indicated below.

### Token Source

The card token is generated by on of the Front End integration options like [Checkout.Frames](https://docs.checkout.com/docs/frames) or one of the [Mobile SDKs](https://docs.checkout.com/docs/sdks#section-mobile-sdk-libraries). Keep in mind that this token expires in 15 minutes and it's a single time use token.

```jsx
var paymentRequest = new PaymentRequest<TokenSource>(
    new TokenSource("tok_ubfj2q76miwundwlk72vxt2i7q"), Currency.USD, 1000)
    {
        Reference = "ORD-090857",
        Capture = true,
        ThreeDS = false
    };
);
```

### Id Source

After you perform at least one successful payment for a customer, Checkout.com will return a <Highlight color="#02b48f">source ID</Highlight>. This id does not expire, so it can be used perform payments without needing the customer to enter the card details again.

```jsx
var paymentRequest = new PaymentRequest<IdSource>(
    new IdSource("src_wmlfc3zyhqzehihu7giusaaawu"), Currency.GBP, 1000)
    {
        Reference = "ORD-090857",
        Capture = true,
        ThreeDS = false
    };
```

### Full Card Details

:::warning

You need to have a high level of PCI Compliance (SAQ-D) to be able to send requests with full card details. Note that unless this payment option is enabled on your account by Checkout.com, the <Highlight color="#5A522C">request will fail</Highlight>. Contact you account manager to request access for this payment interaction.

:::

```jsx
var paymentRequest = new PaymentRequest<CardSource>(
    new CardSource("4242424242424242", 6, 2018){ Cvv = "100" }, Currency.GBP, 1000)
    {
        Reference = "ORD-090857",
        Capture = true,
        ThreeDS = false
    };
```


### Existing Customer

After you perform at least one successful payment for a customer, Checkout.com will return a <Highlight color="#02b48f">Customer.Id</Highlight>. This id can be used perform payments without needing the customer to enter the card details again.

```jsx
var paymentRequest = new PaymentRequest<CustomerSource>(
    new CustomerSource("cus_lgrhodia3haevn5gc6hp6oqhfu", "user@checkout.com"), 
    Currency.GBP, 1000)
    {
        Reference = "ORD-090857",
        Capture = true,
        ThreeDS = false
    };
```

<!-- /////// -->
### Local payment method

The [API Reference](https://api-reference.checkout.com/) contains a list of local payment options that you can use, as well as the other information required in the payment source (if required)

This is an example of a payment request for <Highlight color="#25c2a0">iDeal</Highlight>:

```js
var alternativePaymentSource = new AlternativePaymentSource("ideal")
{
    { "bic", "INGBNL2A" },
    { "description", "NET SDK Test" },
    { "language", "nl"}
};

PaymentRequest<IRequestSource> paymentRequest = new PaymentRequest<IRequestSource>(
    alternativePaymentSource,
    "EUR",
    1000
);

PaymentResponse apiResponse = await api.Payments.RequestAsync(paymentRequest);
PaymentPending pendingPayment = apiResponse.Pending;
```

As you can see from the [API Reference](https://api-reference.checkout.com/) this request is meant to return a redirection URL, so you can let the customer complete the transaction on the local payment's website. Normally a successful response would look like this:

```json
{
    "id": "pay_y3gars76cvrudairph27ekzpvm",
    "status": "Pending",
    "customer": {
        "id": "cus_zbsnutwm2hoevnxnyj6o26sibe"
    },
    "_links": {
        "self": {
            "href": "https://api.sandbox.checkout.com/payments/pay_y3gars76cvrudairph27ekzpvm"
        },
        "redirect": {
            "href": "https://sandbox.checkout.com/LP.Core/api/payment/191952"
        }
    }
}
```

You can access the redirect link in <Highlight color="#25c2a0">response.Pending.Links["redirect"].Href)</Highlight>




## Request a <Highlight color="#25c2a0">3D Secure payment</Highlight>

You have the ability to request 3DS in a payment request. The request body is similar to normal card payments, but with some additional parameters. [Read more about 3DS](https://docs.checkout.com/docs/3d-secure-payments)

```js
TokenSource tokenSource = new TokenSource(token);
var paymentRequest = new PaymentRequest<TokenSource>(new TokenSource("tok_ubfj2q76miwundwlk72vxt2i7q"), Currency.GBP, 1000)
{
    Reference = "ORD-090857",
    ThreeDS = true
};
var response = await api.Payments.RequestAsync(paymentRequest);

```

Similar to local payment options, 3D Secure payments will return a redirection URL. Here is an example of a 3DS response:

```json
{
    "id": "pay_krq2q22lblsevfkay2gfyvatta",
    "status": "Pending",
    "customer": {
        "id": "cus_c5c7d5f4avnehbhhgmnkdadkdu"
    },
    "3ds": {
        "downgraded": false,
        "enrolled": "Y"
    },
    "_links": {
        "self": {
            "href": "https://api.sandbox.checkout.com/payments/pay_krq2q22lblsevfkay2gfyvatta"
        },
        "redirect": {
            "href": "https://3ds2-sandbox.ckotech.co/interceptor/3ds_dr6us33uu57utjwh7yl5szcgqy"
        }
    }
}
```
You can access the redirect link in <Highlight color="#25c2a0">response.Pending.Links["redirect"].Href)</Highlight>



## Handle card <Highlight color="#25c2a0">payment responses</Highlight>

Assuming the payment request is valid, the Payments API can return one of two responses:

1. Pending (HTTP 202) - Asynchronous payment methods or any that require a redirect such as 3D-Secure payments
2. Successfully Processed (HTTP 201) - Could be approved or declined

To cater for both scenarios, all payment requests made by the SDK return `PaymentResponse`, a union type that exposes both return types:

```jsx
public class PaymentResponse
{
    /// <summary>
    /// Gets the processed response returned following a successfully processed payment (HTTP Status Code 201).
    /// </summary>
    public PaymentProcessed Payment { get; set; }

    /// <summary>
    /// Gets the pending response returned for asynchronous payments or when further action such as a redirect is required (HTTP Status Code 201).
    /// </summary>
    public PaymentPending Pending { get; set; }

    ...
```

The example below demonstrates a card token payment flow that handles both 3DS and non-3DS card payments:

```jsx
try
{
    var paymentResponse = await api.Payments.RequestAsync(paymentRequest);

    // 3D-Secure / Alternative Payments
    if (paymentResponse.IsPending && paymentResponse.Pending.RequiresRedirect())
    {
        return RedirectCustomer(paymentResponse.Pending.GetRedirectLink().Href);
    }

    var payment = paymentResponse.Payment;

    if (payment.Approved)
    {
        if (payment.CanCapture()) // if not using auto capture
        {
            await api.Payments.CaptureAsync(paymentResponse.Payment.Id);
        }

        return Approved(payment);
    }

    return Declined();
}
catch (CheckoutValidationException validationEx)
{
    return ShowValidationMessage(validationEx.Error);
}
catch (CheckoutApiException apiEx)
{
    Log.Error(apiEx, "Checkout API returned {HttpStatusCode}", apiEx.HttpStatusCode);
    throw;
}
```

### Determining Payment Outcome

To determine the success of a _processed_ payment, always use the `Approved` property. 

### Obtaining Source Details

When a payment is successfully processed the response will include the payment source details. If the source is _reusable_, such as a card, the response will include a source ID that can be used for subsequent payments. 

Given the source type can vary you will need to cast to the appropriate type to obtain full details. Extension methods are provided for this purpose:

**Cards**

```jsx
var card = paymentResponse.Payment.Source.AsCard();
SaveCardDetails(card.Id, card.Scheme, card.Last4, card.Fingerprint, card.ExpiryMonth, card.ExpiryYear);
```

**Alternative Payment Methods**

Since the response fields can vary for Alternative Payment Methods they are exposed as a dictionary type using the field names as per the [API Reference](https://api-reference.checkout.com).

```jsx
var apm = paymentResponse.Payment.Source.AsApm();
SaveApmDetails(apm.Id, apm.Type, apm["iban"], apm["sofort_id"]);
```

### Hypermedia

Our API responses may include hypermedia links describing additional actions that can be be performed on the resource. Any pending payments that require a redirect will include a `redirect` link that you should direct your customer to. The SDK provides convenience methods for many of these links, such as the `RequiresRedirect()` and `GetRedirectLink()` methods above.


## Get payment details

### Using Payment ID

```jsx
GetPaymentResponse payment = await _api.Payments.GetAsync("pay_y3oqhf46pyzuxjbcn2giaqnb44");
```

### Using Session ID

```jsx
GetPaymentResponse payment = await _api.Payments.GetAsync("sid_ubfj2q76miwundwlk72vxt2i7q");
```

## Get payment actions

```jsx
IEnumerable<PaymentAction> actionsResponse = await api.Payments.GetActionsAsync("pay_y3oqhf46pyzuxjbcn2giaqnb44");
```

## Capture a payment

```jsx
var captureResponse = await api.Payments.CaptureAsync("pay_y3oqhf46pyzuxjbcn2giaqnb44");
```

## Refund a payment

```jsx
var refundResponse = await api.Payments.RefundAsync("pay_y3oqhf46pyzuxjbcn2giaqnb44");
```

## Void a payment

```js
var voidResponse = await api.Payments.VoidAsync("pay_y3oqhf46pyzuxjbcn2giaqnb44");
```